<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>PROMarket ‚Äî Premium Service</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script>
        (function() {
            var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile || window.innerWidth < 768) {
                document.documentElement.classList.add('mobile');
            }
        })();
    </script>
    <!-- Leaflet CSS –∏ JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <!-- Particles.js, GSAP, Chart.js -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        /* === –ú–û–ë–ò–õ–¨–ù–´–ï –°–¢–ò–õ–ò –° –ü–†–ò–û–†–ò–¢–ï–¢–û–ú === */
        @media (max-width: 768px) {
            .search-bar {
                background: transparent !important;
                border: none !important;
                width: 120px !important;
                margin: 0 auto !important;
                padding: 0 !important;
            }
            .search-bar input {
                font-size: 0.8rem !important;
                background: transparent !important;
                border: none !important;
                outline: none !important;
                width: 100% !important;
                margin-left: 5px !important;
                color: var(--text-main) !important;
            }
            .search-bar i {
                color: var(--text-muted) !important;
            }
            .desktop-only {
                display: none !important;
            }
            .notification-badge {
                display: none !important;
            }
            .grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 4px !important;
            }
            .card {
                padding: 4px !important;
                width: 100% !important;
                min-width: 0 !important;
            }
            .card h3 {
                font-size: 0.75rem !important;
                margin: 2px 0 !important;
                word-break: break-word !important;
            }
            .category-tag {
                font-size: 0.45rem !important;
                padding: 2px 3px !important;
            }
            .price {
                font-size: 0.85rem !important;
                margin: 2px 0 !important;
            }
            .price span {
                font-size: 0.6rem !important;
            }
            .card p {
                display: none !important;
            }
            .card .btn-outline:last-child {
                display: none !important;
            }
            .btn-primary {
                padding: 4px !important;
                font-size: 0.6rem !important;
                min-height: 26px !important;
            }
            .card-header {
                margin-bottom: 2px !important;
                align-items: center !important;
            }
            .fav-btn,
            .compass-icon,
            .fa-share-alt {
                font-size: 0.7rem !important;
                min-height: 26px !important;
                min-width: 26px !important;
            }
            .distanceHtml {
                font-size: 0.55rem !important;
            }
            .btn, .fav-btn, .compare-checkbox, .compass-icon {
                min-height: 26px !important;
                min-width: 26px !important;
            }
            .compare-checkbox {
                width: 12px !important;
                height: 12px !important;
            }
            .avatar {
                width: 24px !important;
                height: 24px !important;
                font-size: 0.8rem !important;
                margin-right: 4px !important;
            }
            /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .view-orders .grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            .view-orders .card {
                padding: 15px !important;
                font-size: 1rem !important;
            }
            .view-orders .card h3 {
                font-size: 1.1rem !important;
                margin: 5px 0 !important;
            }
            .view-orders .card p {
                display: block !important;
                font-size: 0.9rem !important;
            }
            .view-orders .price {
                font-size: 1.2rem !important;
            }
            .view-orders .card .btn-outline {
                display: block !important;
                min-height: 40px !important;
                font-size: 0.9rem !important;
                padding: 8px !important;
            }
        }
        /* –î—É–±–ª–∏—Ä—É–µ–º –¥–ª—è –∫–ª–∞—Å—Å–∞ .mobile (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç) */
        .mobile .search-bar {
            background: transparent !important;
            border: none !important;
            width: 120px !important;
            margin: 0 auto !important;
            padding: 0 !important;
        }
        .mobile .search-bar input {
            font-size: 0.8rem !important;
            background: transparent !important;
            border: none !important;
            outline: none !important;
            width: 100% !important;
            margin-left: 5px !important;
            color: var(--text-main) !important;
        }
        .mobile .search-bar i {
            color: var(--text-muted) !important;
        }
        .mobile .desktop-only {
            display: none !important;
        }
        .mobile .notification-badge {
            display: none !important;
        }
        .mobile .grid {
            grid-template-columns: repeat(2, 1fr) !important;
            gap: 4px !important;
        }
        .mobile .card {
            padding: 4px !important;
            width: 100% !important;
            min-width: 0 !important;
        }
        .mobile .card h3 {
            font-size: 0.75rem !important;
            margin: 2px 0 !important;
            word-break: break-word !important;
        }
        .mobile .category-tag {
            font-size: 0.45rem !important;
            padding: 2px 3px !important;
        }
        .mobile .price {
            font-size: 0.85rem !important;
            margin: 2px 0 !important;
        }
        .mobile .price span {
            font-size: 0.6rem !important;
        }
        .mobile .card p {
            display: none !important;
        }
        .mobile .card .btn-outline:last-child {
            display: none !important;
        }
        .mobile .btn-primary {
            padding: 4px !important;
            font-size: 0.6rem !important;
            min-height: 26px !important;
        }
        .mobile .card-header {
            margin-bottom: 2px !important;
            align-items: center !important;
        }
        .mobile .fav-btn,
        .mobile .compass-icon,
        .mobile .fa-share-alt {
            font-size: 0.7rem !important;
            min-height: 26px !important;
            min-width: 26px !important;
        }
        .mobile .distanceHtml {
            font-size: 0.55rem !important;
        }
        .mobile .btn, .mobile .fav-btn, .mobile .compare-checkbox, .mobile .compass-icon {
            min-height: 26px !important;
            min-width: 26px !important;
        }
        .mobile .compare-checkbox {
            width: 12px !important;
            height: 12px !important;
        }
        .mobile .avatar {
            width: 24px !important;
            height: 24px !important;
            font-size: 0.8rem !important;
            margin-right: 4px !important;
        }
        .mobile .view-orders .grid {
            grid-template-columns: 1fr !important;
            gap: 15px !important;
        }
        .mobile .view-orders .card {
            padding: 15px !important;
            font-size: 1rem !important;
        }
        .mobile .view-orders .card h3 {
            font-size: 1.1rem !important;
            margin: 5px 0 !important;
        }
        .mobile .view-orders .card p {
            display: block !important;
            font-size: 0.9rem !important;
        }
        .mobile .view-orders .price {
            font-size: 1.2rem !important;
        }
        .mobile .view-orders .card .btn-outline {
            display: block !important;
            min-height: 40px !important;
            font-size: 0.9rem !important;
            padding: 8px !important;
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div id="progress-bar"></div>

    <header>
        <div class="logo" onclick="showView('pros')" style="cursor: pointer;"><i class="fas fa-bolt"></i> PROMarket</div>
        <div class="search-bar">
            <i class="fas fa-search" style="color:#94a3b8"></i>
            <input type="text" id="main-search" placeholder="–ü–æ–∏—Å–∫ –º–∞—Å—Ç–µ—Ä–æ–≤..." autofocus oninput="debounce(getPros, 500)()">
        </div>
        <div style="display: flex; align-items: center;">
            <!-- –ö–æ–ª–æ–∫–æ–ª—å—á–∏–∫ (—Å–∫—Ä—ã—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
            <div class="notification-badge" id="notificationBell" onclick="showNotifications()" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">
                <i class="fas fa-bell fa-lg"></i>
                <span class="badge hidden" id="notificationCount">0</span>
            </div>
            <div class="desktop-only">
                <div id="auth-zone">
                    <button class="btn btn-outline" id="authBtn" onclick="handleAuthAction()" title="–í–æ–π—Ç–∏ / –í—ã–π—Ç–∏">
                        <i class="fas fa-user-circle"></i> <span>–í–æ–π—Ç–∏</span>
                    </button>
                </div>
                <!-- –ö–Ω–æ–ø–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–≤–∏–¥–Ω–∞ –Ω–∞ –ü–ö) -->
                <button id="compare-btn" class="btn btn-outline" style="margin-left:10px;" title="–°—Ä–∞–≤–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–æ–≤">
                    <i class="fas fa-balance-scale"></i>
                </button>
                <button id="filter-toggle" class="btn btn-outline" style="margin-left:10px;" title="–§–∏–ª—å—Ç—Ä—ã">
                    <i class="fas fa-sliders-h"></i>
                </button>
                <button id="theme-toggle" class="btn btn-outline" style="margin-left:10px;" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
            <!-- –ö–Ω–æ–ø–∫–∞ –≥–∞–º–±—É—Ä–≥–µ—Ä —Å –±–µ–π–¥–∂–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
            <button id="menu-toggle" class="btn btn-outline" style="margin-left:10px;" title="–ú–µ–Ω—é">
                <i class="fas fa-bars"></i>
                <span id="hamburger-notif-count" class="badge hidden">0</span>
            </button>
        </div>
    </header>

    <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –≥–∞–º–±—É—Ä–≥–µ—Ä-–º–µ–Ω—é -->
    <div id="hamburger-menu" class="hamburger-menu hidden">
        <ul>
            <li onclick="showView('orders'); toggleHamburgerMenu()"><i class="fas fa-shopping-bag"></i> –ú–æ–∏ –∑–∞–∫–∞–∑—ã</li>
            <li onclick="compareMasters(); toggleHamburgerMenu()"><i class="fas fa-balance-scale"></i> –°—Ä–∞–≤–Ω–∏—Ç—å</li>
            <li onclick="handleAuthAction(); toggleHamburgerMenu()"><i class="fas fa-sign-in-alt"></i> <span id="menu-auth-text">–í–æ–π—Ç–∏</span></li>
            <li onclick="toggleTheme(); toggleHamburgerMenu()"><i class="fas fa-moon"></i> <span id="menu-theme-text">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span></li>
            <li onclick="toggleSidebar(); toggleHamburgerMenu()"><i class="fas fa-sliders-h"></i> –§–∏–ª—å—Ç—Ä—ã</li>
            <li onclick="showNotifications(); toggleHamburgerMenu()">
                <i class="fas fa-bell"></i> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                <span id="menu-notif-count" class="badge hidden">0</span>
            </li>
            <li onclick="clearAllFavorites(); toggleHamburgerMenu()"><i class="fas fa-heart-broken"></i> –û—á–∏—Å—Ç–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</li>
            <li onclick="showStatistics(); toggleHamburgerMenu()"><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</li>
            <li onclick="randomMaster(); toggleHamburgerMenu()"><i class="fas fa-random"></i> –°–ª—É—á–∞–π–Ω—ã–π –º–∞—Å—Ç–µ—Ä</li>
            <li onclick="showAbout(); toggleHamburgerMenu()"><i class="fas fa-info-circle"></i> –û –ø—Ä–æ–µ–∫—Ç–µ</li>
        </ul>
    </div>

    <div class="app-container">
        <aside class="sidebar">
            <div style="display: flex; justify-content: flex-end; padding: 10px;">
                <button id="sidebar-close" class="btn btn-outline" style="padding: 8px 12px;">‚úï</button>
            </div>
            <div id="map" class="styled-map"></div>
            <div class="tabs-nav">
                <button class="tab-btn active" id="t-pros" onclick="showView('pros')">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã</button>
                <button class="tab-btn" id="t-orders" onclick="showView('orders')">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</button>
            </div>
            <div class="filter-content">
                <!-- —Ñ–∏–ª—å—Ç—Ä—ã -->
                <div class="filter-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥</label>
                    <select id="f-cat" onchange="getPros()">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="–†–µ–º–æ–Ω—Ç">üõ† –†–µ–º–æ–Ω—Ç</option>
                        <option value="–£–±–æ—Ä–∫–∞">üßπ –£–±–æ—Ä–∫–∞</option>
                        <option value="IT">üíª IT-—É—Å–ª—É–≥–∏</option>
                        <option value="–ö—Ä–∞—Å–æ—Ç–∞">‚ú® –ö—Ä–∞—Å–æ—Ç–∞</option>
                        <option value="–ü–µ—Ä–µ–µ–∑–¥—ã">üì¶ –ü–µ—Ä–µ–µ–∑–¥—ã</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥</label>
                    <select id="f-rate" onchange="getPros()">
                        <option value="0">–õ—é–±–æ–π</option>
                        <option value="4.5">–í—ã—Å–æ–∫–∏–π (4.5+ ‚òÖ)</option>
                        <option value="4.8">–≠–ª–∏—Ç–Ω—ã–π (4.8+ ‚òÖ)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)</label>
                    <input type="number" id="f-price" placeholder="–õ—é–±–∞—è" oninput="getPros()">
                </div>
                <div class="filter-group">
                    <label>
                        <input type="checkbox" id="f-verified" onchange="getPros()"> –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ
                    </label>
                </div>
                <div class="filter-group">
                    <label>
                        <input type="checkbox" id="f-favorites" onchange="getPros()"> –¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ
                    </label>
                </div>
                <div class="filter-group">
                    <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                    <select id="f-sort" onchange="getPros()">
                        <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                        <option value="price_asc">–¶–µ–Ω–∞ (—Å–Ω–∞—á–∞–ª–∞ –¥–µ—à—ë–≤—ã–µ)</option>
                        <option value="price_desc">–¶–µ–Ω–∞ (—Å–Ω–∞—á–∞–ª–∞ –¥–æ—Ä–æ–≥–∏–µ)</option>
                        <option value="rating_desc">–†–µ–π—Ç–∏–Ω–≥ (—Å–Ω–∞—á–∞–ª–∞ –≤—ã—Å–æ–∫–∏–π)</option>
                        <option value="distance_asc">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–±–ª–∏–∂–µ)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button class="btn btn-outline" onclick="resetFilters()" style="width:100%;">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                </div>
            </div>
        </aside>

        <main class="main" id="main-content">
            <div id="view-pros" class="view">
                <div id="pros-loader" class="loader hidden">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤...</div>
                <div id="pros-list" class="grid"></div>
                <div id="scroll-indicator" style="height: 3px; background: var(--primary); width: 0%; position: sticky; bottom: 0; left: 0;"></div>
            </div>
            <div id="view-orders" class="view hidden">
                <div id="orders-loader" class="loader hidden">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</div>
                <div id="orders-list" class="grid"></div>
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal-bg" id="modal-auth">
        <div class="modal-box">
            <h2>–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!</h2>
            <p style="color:var(--text-muted)">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å—É</p>
            <input type="email" id="auth-email" placeholder="Email">
            <input type="password" id="auth-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn btn-primary" style="margin-top:25px" onclick="doLogin()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            <button class="btn btn-outline" style="width:100%; margin-top:12px" onclick="closeModal('modal-auth')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div class="modal-bg" id="modal-booking">
        <div class="modal-box">
            <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
            <p id="book-info" style="color:var(--primary); font-weight:700"></p>
            <label>–î–∞—Ç–∞ –≤–∏–∑–∏—Ç–∞</label>
            <input type="date" id="book-date">
            <label>–í—Ä–µ–º—è</label>
            <input type="time" id="book-time">
            <label>–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?</label>
            <textarea id="book-comment" rows="3" placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É..."></textarea>
            <label>–ü—Ä–æ–º–æ–∫–æ–¥</label>
            <input type="text" id="promo-code" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
            <div id="promo-message" style="font-size:0.8rem; color:red; margin:5px 0; min-height:20px;"></div>
            <button class="btn btn-outline" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
            <button class="btn btn-primary" style="margin-top:25px" onclick="confirmBooking()">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—Ç–µ—Ä—É</button>
            <button class="btn btn-outline" style="width:100%; margin-top:12px" onclick="closeModal('modal-booking')">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div class="modal-bg" id="modal-notifications">
        <div class="modal-box">
            <h2>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
            <div id="notifications-list"></div>
            <button class="btn btn-outline" style="width:100%; margin-top:12px" onclick="closeModal('modal-notifications')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div class="modal-bg" id="modal-chat">
        <div class="modal-box">
            <h2 id="chat-with"></h2>
            <div class="chat-messages" id="chat-messages"></div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="chat-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex: 1;">
                <button class="btn btn-primary" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
            <button class="btn btn-outline" style="width:100%; margin-top:12px" onclick="closeModal('modal-chat')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="compare-modal" class="modal-bg" style="display:none;">
        <div class="modal-box" style="width:800px; max-width:95%;">
            <h2>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–æ–≤</h2>
            <div id="compare-content"></div>
            <button class="btn btn-outline" onclick="closeCompareModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="toast-container"></div>
    <button id="scrollTop" class="btn btn-primary" title="–ù–∞–≤–µ—Ä—Ö">‚Üë</button>

    <script src="client.js"></script>
</body>
</html>